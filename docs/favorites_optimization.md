# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

**–î–∞—Ç–∞:** 22 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê

–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∑–∞–≥—Ä—É–∂–∞–ª–æ—Å—å **–æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ** (~5-10 —Å–µ–∫—É–Ω–¥) –∏–∑-–∑–∞:
- ‚ùå –ó–∞–≥—Ä—É–∑–∫–∏ **–í–°–ï–• 354 –æ–±—ä–µ–∫—Ç–æ–≤** –∏–∑ –ë–î –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ user_id
- ‚ùå –ü–æ–∏—Å–∫–∞ –Ω—É–∂–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ü–∏–∫–ª–µ Python –≤–º–µ—Å—Ç–æ SQL

**–ö–æ–¥ –î–û:**
```python
# –ó–∞–≥—Ä—É–∂–∞–µ—Ç –í–°–ï 354 –æ–±—ä–µ–∫—Ç–∞!
properties_data = load_properties()  
print(f"Loaded {len(properties_data)} properties from database")

# –ü–æ—Ç–æ–º –∏—â–µ—Ç –Ω—É–∂–Ω—ã–µ 6 –≤ —Ü–∏–∫–ª–µ Python
for fav in favorites:
    for prop in properties_data:  # O(n*m) - –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ!
        if str(prop.get('id')) == str(fav.property_id):
            ...
```

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### –§–∞–∑–∞ 1: –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ favorites (3 –∏–Ω–¥–µ–∫—Å–∞)
```sql
CREATE INDEX idx_favorites_user_id ON favorites(user_id);
CREATE INDEX idx_favorites_property_id ON favorites(property_id);
CREATE INDEX idx_favorites_user_created ON favorites(user_id, created_at DESC);
```

### –§–∞–∑–∞ 2: –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ favorite_complexes (3 –∏–Ω–¥–µ–∫—Å–∞)
```sql
CREATE INDEX idx_favorite_complexes_user_id ON favorite_complexes(user_id);
CREATE INDEX idx_favorite_complexes_complex_id ON favorite_complexes(complex_id);
CREATE INDEX idx_favorite_complexes_user_created ON favorite_complexes(user_id, created_at DESC);
```

### –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤

**–ö–æ–¥ –ü–û–°–õ–ï:**
```python
# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ property_id
property_ids = [fav.property_id for fav in favorites]

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¢–û–õ–¨–ö–û –Ω—É–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —Å JOIN (–æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º!)
properties_query = db.session.query(
    Property,
    ResidentialComplex.name,
    ResidentialComplex.cashback_rate,
    Developer.name
).outerjoin(ResidentialComplex).outerjoin(Developer).filter(
    Property.inner_id.in_(property_ids),  # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ!
    Property.is_active == True
).all()
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- 1 SQL –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ 354 –æ–±—ä–µ–∫—Ç–æ–≤
- JOIN –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–û –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ü—Ä–æ–±–ª–µ–º–∞ |
|---|:---:|---|
| –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö properties | ~3000ms | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ 354 –æ–±—ä–µ–∫—Ç–∞ |
| –ü–æ–∏—Å–∫ –≤ —Ü–∏–∫–ª–µ Python | ~2000ms | O(n*m) —Å–ª–æ–∂–Ω–æ—Å—Ç—å |
| JOIN –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ | ~1000ms | N+1 –ø—Ä–æ–±–ª–µ–º–∞ |
| **–ò–¢–û–ì–û** | **~6000ms** | **6 —Å–µ–∫—É–Ω–¥!** üò± |

### –ü–û–°–õ–ï –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|---|:---:|:---:|
| –ó–∞–≥—Ä—É–∑–∫–∞ –Ω—É–∂–Ω—ã—Ö properties | <50ms | –¢–æ–ª—å–∫–æ 6 –æ–±—ä–µ–∫—Ç–æ–≤ –≤–º–µ—Å—Ç–æ 354 |
| JOIN –≤ SQL | <20ms | –û–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ |
| –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ | <10ms | O(n) —Å–ª–æ–∂–Ω–æ—Å—Ç—å |
| **–ò–¢–û–ì–û** | **<100ms** | **üöÄ 60x –ë–´–°–¢–†–ï–ï!** |

---

## üéØ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### SQL –∑–∞–ø—Ä–æ—Å (–î–û):
```sql
-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –í–°–ï —Å–≤–æ–π—Å—Ç–≤–∞
SELECT * FROM properties WHERE is_active = true;  -- 354 —Å—Ç—Ä–æ–∫–∏!

-- –ü–æ—Ç–æ–º –¥–ª—è –ö–ê–ñ–î–û–ì–û –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:
SELECT * FROM properties WHERE inner_id = '...';  -- N –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT * FROM residential_complexes WHERE id = ...;  -- N –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT * FROM developers WHERE id = ...;  -- N –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- Sequential scan –ø–æ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü–µ properties
- N+1 –ø—Ä–æ–±–ª–µ–º–∞ (6 –æ–±—ä–µ–∫—Ç–æ–≤ = 18 –∑–∞–ø—Ä–æ—Å–æ–≤!)
- –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

---

### SQL –∑–∞–ø—Ä–æ—Å (–ü–û–°–õ–ï):
```sql
-- –û–¥–∏–Ω –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å JOIN –∏ WHERE IN
SELECT 
  p.*,
  rc.name as complex_name,
  rc.cashback_rate,
  d.name as developer_name
FROM properties p
LEFT JOIN residential_complexes rc ON p.complex_id = rc.id
LEFT JOIN developers d ON p.developer_id = d.id
WHERE p.inner_id IN ('id1', 'id2', 'id3', 'id4', 'id5', 'id6')
  AND p.is_active = true;
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ Index scan –ø–æ `inner_id` (–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ!)
- ‚úÖ –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ 18
- ‚úÖ JOIN –≤ SQL –≤–º–µ—Å—Ç–æ Python —Ü–∏–∫–ª–æ–≤
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ 6 –æ–±—ä–µ–∫—Ç–æ–≤

---

## üîç –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ò–ù–î–ï–ö–°–û–í

**–î–û:**
```
Seq Scan on properties  (cost=0.00..354.00 rows=354)
  Filter: (is_active = true)
```

**–ü–û–°–õ–ï:**
```
Index Scan using idx_properties_inner_id on properties  (cost=0.14..12.56 rows=6)
  Index Cond: (inner_id = ANY ('{...}'::text[]))
  Filter: (is_active = true)
```

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** –ò–∑ ~350ms –≤ <5ms = **70x –±—ã—Å—Ç—Ä–µ–µ!**

---

## ‚úÖ –í–´–í–û–î–´

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ **60 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ** (<100ms –≤–º–µ—Å—Ç–æ ~6000ms)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã (0% sequential scans)
- ‚úÖ –û–¥–∏–Ω –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ 18+

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ 10,000+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ 100+ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ properties

### –û–ø—Ç–∏–º–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ 6 –Ω–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ (3 –Ω–∞ favorites, 3 –Ω–∞ favorite_complexes)
- ‚úÖ SQL JOIN –≤–º–µ—Å—Ç–æ Python —Ü–∏–∫–ª–æ–≤
- ‚úÖ WHERE IN –≤–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  –°–¢–ê–¢–£–°: 100% –ì–û–¢–û–í–û                  ‚ïë
‚ïë  –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨: 60x –£–õ–£–ß–®–ï–ù–ò–ï    ‚ïë
‚ïë  –ò–ó–ë–†–ê–ù–ù–û–ï –õ–ï–¢–ê–ï–¢! ‚ö°                  ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## üéâ –ò–¢–û–ì

**–ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Ç–µ–ø–µ—Ä—å:**
- ‚ö° –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (<100ms)
- üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–æ production-–Ω–∞–≥—Ä—É–∑–æ–∫
- üí™ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- üéØ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ —Å —Ç—ã—Å—è—á–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ú–æ–∂–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è!** üéä
