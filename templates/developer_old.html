{% extends "base.html" %}

{% block title %}{{ developer_name }} - Проекты застройщика с кэшбеком | InBack{% endblock %}
{% block description %}Все проекты застройщика {{ developer_name }} с кэшбеком до 10%. {{ total_properties }} квартир в {{ complexes|length }} жилых комплексах. Гарантированный возврат средств при покупке недвижимости.{% endblock %}
{% block keywords %}{{ developer_name }}, новостройки {{ developer_name }}, кэшбек застройщик, жилые комплексы {{ developer_name }}, ипотека новостройки{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "RealEstateAgent", 
  "name": "{{ developer_name }}",
  "description": "Застройщик {{ developer_name }} предлагает {{ total_properties }} квартир с кэшбеком через InBack",
  "areaServed": {
    "@type": "AdministrativeArea",
    "name": "Краснодар и Краснодарский край"
  },
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Краснодар",
    "addressRegion": "Краснодарский край"
  }
}
</script>
<script>
tailwind.config = {
    theme: {
        extend: {
            colors: {
                ton: {
                    blue: '#0088cc',
                    dark: '#222426', 
                    light: '#f5f5f5',
                    accent: '#00a3e0',
                }
            },
            fontFamily: {
                sans: ['Manrope', 'sans-serif'],
            },
        }
    }
}
</script>
{% endblock %}

{% block breadcrumbs %}
<div class="container mx-auto px-4 py-3 text-sm">
<nav aria-label="Breadcrumb" class="flex">
<ol class="inline-flex items-center space-x-1 md:space-x-3">
<li class="inline-flex items-center">
<a class="text-[#0088CC] hover:underline inline-flex items-center" href="{{ url_for('index') }}">
<svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                        Главная
                    </a>
</li>
<li>
<div class="flex items-center">
<svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path clip-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" fill-rule="evenodd"></path></svg>
<a class="text-[#0088CC] hover:underline ml-1 md:ml-2" href="{{ url_for('developers') }}">Застройщики</a>
</div>
</li>
<li aria-current="page">
<div class="flex items-center">
<svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path clip-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" fill-rule="evenodd"></path></svg>
<span class="text-gray-500 ml-1 md:ml-2">{{ developer_name }}</span>
</div>
</li>
</ol>
</nav>
</div>
{% endblock %}

{% block content %}
<div class="bg-gray-50">
<div class="max-w-6xl mx-auto px-4 py-8">

<!-- Developer Header Section -->
<div class="flex flex-col md:flex-row gap-6 mb-8 items-start">
<div class="w-32 h-32 rounded-xl overflow-hidden bg-gray-100 flex-shrink-0">
{% if developer.logo_url %}
<img src="{{ developer.logo_url }}" alt="Логотип {{ developer.name }}" class="w-full h-full object-contain">
{% else %}
<div class="w-full h-full bg-ton-blue bg-opacity-10 flex items-center justify-center">
<span class="text-ton-blue font-bold text-2xl">{{ developer.name[:2] if developer.name|length > 10 else developer.name[:3] }}</span>
</div>
{% endif %}
</div>
<div class="flex-1">
<h1 class="text-3xl font-bold mb-2">{{ developer.full_name or developer.name }}</h1>
<div class="flex flex-wrap gap-2 mb-4">
<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">Застройщик</span>
{% if developer.experience_years >= 15 %}
<span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">Опыт {{ developer.experience_years }} лет</span>
{% endif %}
<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">{{ developer.total_complexes or complexes|length }}+ проектов</span>
</div>
<p class="text-gray-600 mb-4">{{ developer.description or (developer.name + " - " + ("крупный застройщик" if complexes|length >= 5 else ("средний застройщик" if complexes|length >= 3 else "локальный застройщик")) + " Краснодарского края с портфелем из " + complexes|length|string + " жилых комплексов") }}</p>
<div class="flex flex-col sm:flex-row sm:items-center gap-4 text-gray-600">
<div class="flex items-center gap-2">
<i class="fas fa-phone-alt text-blue-600"></i>
<span>{{ developer.phone or "+7 (861) 205-55-77" }}</span>
</div>
<div class="flex items-center gap-2">
<i class="fas fa-globe text-blue-600"></i>
<span>{{ developer.website or (developer.name|lower|replace(' ', '')|replace('гк', '')|replace('оао', '')|replace('оoo', '') + ".ru") }}</span>
</div>
</div>
</div>
</div>

<!-- Search and Stats Section -->
<div class="bg-white rounded-xl shadow-sm p-6 mb-8">
<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
<h2 class="text-xl font-bold">Поиск по проектам застройщика</h2>
<div class="relative w-full md:w-96">
<input type="text" placeholder="Найти ЖК по названию или району" class="w-full border border-gray-300 rounded-xl pl-10 pr-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
<i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
</div>
</div>

<div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-6">
<div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
<div class="text-gray-500 text-sm mb-1">Построено ЖК</div>
<div class="text-2xl font-bold text-blue-600">{{ developer.total_complexes or complexes|length }}</div>
</div>
<div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
<div class="text-gray-500 text-sm mb-1">Квартир в продаже</div>
<div class="text-2xl font-bold text-blue-600">{{ developer.total_properties or total_properties }}+</div>
</div>
<div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
<div class="text-gray-500 text-sm mb-1">Средний рейтинг</div>
<div class="text-2xl font-bold text-blue-600">{{ developer.rating }}</div>
</div>
<div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
<div class="text-gray-500 text-sm mb-1">На рынке</div>
<div class="text-2xl font-bold text-blue-600">{{ developer.experience_years }}+ лет</div>
</div>
</div>
</div>

<!-- Developer Info Section -->
<div class="bg-white rounded-2xl overflow-hidden shadow-lg mb-8 p-6">
<div class="flex flex-col md:flex-row md:justify-between md:items-start gap-6">
<!-- Левая колонка -->
<div class="flex-1">
<!-- Адрес -->
<div class="mb-6">
<div class="flex items-center text-gray-600 mb-1">
<i class="fas fa-map-marker-alt mr-2 text-[#0088cc]"></i>
<span>{{ developer.address or "г. Краснодар, ул. Красная, 180" }}</span>
</div>
<p class="text-sm text-gray-500">Головной офис застройщика в Краснодарском крае</p>
</div>

<!-- Характеристики застройщика -->
<div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
<div>
<p class="text-gray-500 text-sm">Год основания</p>
<p class="font-semibold">{{ developer.established_year or "2010" }}</p>
</div>
<div>
<p class="text-gray-500 text-sm">Реализовано ЖК</p>
<p class="font-semibold">{{ developer.total_complexes or complexes|length }}</p>
</div>
<div>
<p class="text-gray-500 text-sm">Квартир сдано</p>
<p class="font-semibold">{{ developer.properties_sold or (total_properties * 3) }}+</p>
</div>
<div>
<p class="text-gray-500 text-sm">Рейтинг на ДомКлик</p>
<p class="font-semibold">{{ developer.rating }}/5</p>
</div>
<div>
<p class="text-gray-500 text-sm">Общая площадь</p>
<p class="font-semibold">{{ ((developer.total_properties or total_properties) * 65 / 1000)|round }}0 тыс. м²</p>
</div>
<div>
<p class="text-gray-500 text-sm">Опыт работы</p>
<p class="font-semibold">{{ developer.experience_years }} лет</p>
</div>
</div>

<!-- Описание застройщика -->
<div class="mb-8">
<h2 class="text-xl font-bold mb-4">О застройщике</h2>
<div class="prose max-w-none text-gray-700">
<p>{{ developer.description or (developer.name + " - " + ("крупный застройщик" if complexes|length >= 5 else ("средний застройщик" if complexes|length >= 3 else "локальный застройщик")) + " Краснодарского края с опытом работы более 10 лет. Компания специализируется на строительстве жилых комплексов комфорт-класса с развитой инфраструктурой.") }}</p>

<h3 class="text-lg font-semibold mt-6 mb-3">Основные направления деятельности:</h3>
<ul class="list-disc pl-5 space-y-2">
<li>Строительство многоквартирных жилых домов</li>
<li>Развитие придомовых территорий</li>
<li>Создание инфраструктурных объектов</li>
<li>Управление жилыми комплексами</li>
</ul>

<h3 class="text-lg font-semibold mt-6 mb-3">Преимущества компании:</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="flex items-start gap-3">
<div class="flex-shrink-0 mt-1 text-blue-600">
<i class="fas fa-check-circle"></i>
</div>
<p>Собственное производство строительных материалов</p>
</div>
<div class="flex items-start gap-3">
<div class="flex-shrink-0 mt-1 text-blue-600">
<i class="fas fa-check-circle"></i>
</div>
<p>Строгий контроль качества на всех этапах строительства</p>
</div>
<div class="flex items-start gap-3">
<div class="flex-shrink-0 mt-1 text-blue-600">
<i class="fas fa-check-circle"></i>
</div>
<p>Соблюдение сроков сдачи объектов</p>
</div>
<div class="flex items-start gap-3">
<div class="flex-shrink-0 mt-1 text-blue-600">
<i class="fas fa-check-circle"></i>
</div>
<p>Гибкие условия покупки и ипотечные программы</p>
</div>
</div>
</div>
</div>

<!-- Инфраструктура -->
<div class="mb-6">
<h3 class="font-bold text-lg mb-3">Инфраструктура в проектах</h3>
<div class="grid grid-cols-2 md:grid-cols-3 gap-3">
{% if infrastructure and infrastructure|length > 0 %}
{% for item in infrastructure %}
<div class="flex items-center gap-2">
<div class="w-6 h-6 bg-ton-blue bg-opacity-10 rounded flex items-center justify-center">
<i class="fas fa-check text-sm text-ton-blue"></i>
</div>
<span class="text-sm">{{ item }}</span>
</div>
{% endfor %}
{% else %}
<div class="flex items-center gap-2">
<div class="w-6 h-6 bg-ton-blue bg-opacity-10 rounded flex items-center justify-center">
<i class="fas fa-school text-sm text-ton-blue"></i>
</div>
<span class="text-sm">Детский сад</span>
</div>
<div class="flex items-center gap-2">
<div class="w-6 h-6 bg-ton-blue bg-opacity-10 rounded flex items-center justify-center">
<i class="fas fa-basketball-ball text-sm text-ton-blue"></i>
</div>
<span class="text-sm">Спортплощадки</span>
</div>
<div class="flex items-center gap-2">
<div class="w-6 h-6 bg-ton-blue bg-opacity-10 rounded flex items-center justify-center">
<i class="fas fa-shopping-cart text-sm text-ton-blue"></i>
</div>
<span class="text-sm">Торговые центры</span>
</div>
<div class="flex items-center gap-2">
<div class="w-6 h-6 bg-ton-blue bg-opacity-10 rounded flex items-center justify-center">
<i class="fas fa-car text-sm text-ton-blue"></i>
</div>
<span class="text-sm">Парковка</span>
</div>
<div class="flex items-center gap-2">
<div class="w-6 h-6 bg-ton-blue bg-opacity-10 rounded flex items-center justify-center">
<i class="fas fa-tree text-sm text-ton-blue"></i>
</div>
<span class="text-sm">Благоустройство</span>
</div>
<div class="flex items-center gap-2">
<div class="w-6 h-6 bg-ton-blue bg-opacity-10 rounded flex items-center justify-center">
<i class="fas fa-shield-alt text-sm text-ton-blue"></i>
</div>
<span class="text-sm">Охрана</span>
</div>
{% endif %}
</div>
</div>
</div>

<!-- Правая колонка - карта и реквизиты -->
<div class="flex-1 max-w-md">
<!-- Карта застройщика -->
{% if developer.latitude and developer.longitude %}
<div class="mb-6">
<h3 class="font-bold text-lg mb-3">Расположение офиса</h3>
<div class="bg-gray-100 rounded-xl p-4 h-64 flex items-center justify-center">
<div id="developer-map" class="w-full h-full rounded-lg" style="min-height: 200px;"></div>
</div>
</div>
{% endif %}

<!-- Реквизиты компании -->
{% if developer.inn or developer.kpp or developer.ogrn %}
<div class="bg-gray-50 rounded-xl p-4 mb-6">
<h3 class="font-bold text-lg mb-3">Реквизиты компании</h3>
<div class="space-y-2 text-sm">
{% if developer.inn %}
<div class="flex justify-between">
<span class="text-gray-600">ИНН:</span>
<span class="font-mono">{{ developer.inn }}</span>
</div>
{% endif %}
{% if developer.kpp %}
<div class="flex justify-between">
<span class="text-gray-600">КПП:</span>
<span class="font-mono">{{ developer.kpp }}</span>
</div>
{% endif %}
{% if developer.ogrn %}
<div class="flex justify-between">
<span class="text-gray-600">ОГРН:</span>
<span class="font-mono">{{ developer.ogrn }}</span>
</div>
{% endif %}
{% if developer.legal_address %}
<div>
<span class="text-gray-600">Юридический адрес:</span>
<div class="mt-1">{{ developer.legal_address }}</div>
</div>
{% endif %}
</div>
</div>
{% endif %}

<!-- Банковские реквизиты -->
{% if developer.bank_name or developer.bank_bik or developer.bank_account %}
<div class="bg-gray-50 rounded-xl p-4">
<h3 class="font-bold text-lg mb-3">Банковские реквизиты</h3>
<div class="space-y-2 text-sm">
{% if developer.bank_name %}
<div>
<span class="text-gray-600">Банк:</span>
<div class="mt-1">{{ developer.bank_name }}</div>
</div>
{% endif %}
{% if developer.bank_bik %}
<div class="flex justify-between">
<span class="text-gray-600">БИК:</span>
<span class="font-mono">{{ developer.bank_bik }}</span>
</div>
{% endif %}
{% if developer.bank_account %}
<div class="flex justify-between">
<span class="text-gray-600">Р/с:</span>
<span class="font-mono">{{ developer.bank_account }}</span>
</div>
{% endif %}
</div>
</div>
{% endif %}
</div>
</div>
</div>

<!-- Properties for Sale Section -->
<div class="mb-8">
<h2 class="text-2xl font-bold mb-6">Квартиры в продаже</h2>
<div class="bg-white rounded-xl p-6 shadow-sm">
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
<div class="text-center p-4 bg-gray-50 rounded-lg">
<div class="text-2xl font-bold text-ton-blue mb-1">{{ total_properties }}</div>
<div class="text-sm text-gray-600">Всего квартир</div>
</div>
<div class="text-center p-4 bg-gray-50 rounded-lg">
<div class="text-2xl font-bold text-ton-blue mb-1">{{ (min_price / 1000000)|round(1) }}</div>
<div class="text-sm text-gray-600">млн ₽ от</div>
</div>
<div class="text-center p-4 bg-gray-50 rounded-lg">
<div class="text-2xl font-bold text-ton-blue mb-1">{{ complexes|length }}</div>
<div class="text-sm text-gray-600">ЖК в продаже</div>
</div>
<div class="text-center p-4 bg-gray-50 rounded-lg">
<div class="text-2xl font-bold text-ton-blue mb-1">{{ developer.max_cashback_percent or "10" }}%</div>
<div class="text-sm text-gray-600">макс. кэшбек</div>
</div>
</div>
<div class="flex justify-center">
<a href="{{ url_for('properties') }}?developer={{ developer.name }}" class="bg-ton-blue text-white px-6 py-3 rounded-lg hover:bg-opacity-90 transition-colors font-medium">
Посмотреть все квартиры
</a>
</div>
</div>
</div>

<!-- Projects Section with Tabs -->
{% if complexes %}
<div class="bg-white rounded-xl shadow-sm p-6 mb-8" x-data="{ activeTab: 'all' }">
<h2 class="text-xl font-bold mb-6">Проекты застройщика</h2>

<!-- Tabs -->
<div class="flex overflow-x-auto scroll-hidden mb-6 pb-2">
<button 
@click="activeTab = 'all'" 
:class="activeTab === 'all' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-blue-600'"
class="px-4 py-2 font-medium border-b-2 whitespace-nowrap transition-colors">
Все проекты ({{ complexes|length }})
</button>
<button 
@click="activeTab = 'building'" 
:class="activeTab === 'building' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-blue-600'"
class="px-4 py-2 font-medium border-b-2 whitespace-nowrap transition-colors">
Строятся ({{ complexes|selectattr('status', 'equalto', 'building')|list|length }})
</button>
<button 
@click="activeTab = 'completed'" 
:class="activeTab === 'completed' ? 'text-blue-600 border-blue-600' : 'text-gray-500 border-transparent hover:text-blue-600'"
class="px-4 py-2 font-medium border-b-2 whitespace-nowrap transition-colors">
Сданы ({{ complexes|selectattr('status', 'equalto', 'completed')|list|length }})
</button>
</div>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
{% for complex in complexes %}
<div class="bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-shadow"
x-show="activeTab === 'all' || (activeTab === 'building' && '{{ complex.status }}' === 'building') || (activeTab === 'completed' && '{{ complex.status }}' === 'completed')"
x-transition>
<div class="h-48 bg-gray-200 relative">
<img src="{{ complex.image }}" alt="{{ complex.name }}" class="w-full h-full object-cover">
<div class="absolute top-3 left-3 bg-white/90 backdrop-blur px-2 py-1 rounded-full text-xs font-medium">
{% if complex.status == 'building' %}Строится{% else %}Сдан{% endif %}
</div>
</div>
<div class="p-5">
<h3 class="font-bold text-lg mb-2">{{ complex.name }}</h3>
<div class="flex items-center text-sm text-gray-500 mb-3">
<i class="fas fa-map-marker-alt mr-1"></i>
<span>{{ complex.district }}</span>
</div>

<div class="grid grid-cols-2 gap-3 mb-4">
<div>
<p class="text-gray-500 text-xs">Срок сдачи</p>
<p class="font-medium">{{ complex.completion_date }}</p>
</div>
<div>
<p class="text-gray-500 text-xs">Класс</p>
<p class="font-medium capitalize">{{ complex.building_class }}</p>
</div>
<div>
<p class="text-gray-500 text-xs">Квартир</p>
<p class="font-medium">{{ complex.apartments_count }}</p>
</div>
<div>
<p class="text-gray-500 text-xs">Цена</p>
<p class="font-medium">от {{ "{:,.0f}".format(complex.price_from / 1000000) }} млн ₽</p>
</div>
</div>

<div class="flex justify-between items-center">
<div class="flex items-center">
<div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
<span class="text-xs text-gray-500">Кешбек {{ complex.cashback_percent }}%</span>
</div>
<a href="/complex/{{ complex.id }}" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
Подробнее <i class="fas fa-arrow-right ml-1 text-xs"></i>
</a>
</div>
</div>
</div>
{% endfor %}
</div>
</div>
{% endif %}

<!-- Apartments Section -->
<div class="bg-white rounded-xl shadow-sm p-6 mb-8" x-data="{ roomFilter: 'all', buildingFilter: 'all' }">
<h3 class="font-bold text-xl mb-6">Квартиры в проектах застройщика</h3>

<!-- Apartment Filters -->
<div class="flex flex-wrap gap-3 mb-6">
<div class="relative">
<select x-model="buildingFilter" class="appearance-none bg-white border border-gray-300 rounded-xl px-4 py-2 pr-8 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
<option value="all">Комплекс: Все</option>
{% for complex in complexes %}
<option value="{{ complex.name }}">{{ complex.name }}</option>
{% endfor %}
</select>
<div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
<i class="fas fa-chevron-down text-gray-400"></i>
</div>
</div>
<div class="relative">
<select x-model="roomFilter" class="appearance-none bg-white border border-gray-300 rounded-xl px-4 py-2 pr-8 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
<option value="all">Комнат: Все</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4+</option>
</select>
<div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
<i class="fas fa-chevron-down text-gray-400"></i>
</div>
</div>
</div>

<!-- Apartment Cards -->
{% if apartments %}
<div class="grid md:grid-cols-2 gap-6">
{% for apartment in apartments %}
<div class="bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-shadow"
x-show="(roomFilter === 'all' || roomFilter === '{{ apartment.rooms }}') && (buildingFilter === 'all' || buildingFilter === '{{ apartment.complex_name }}')"
x-transition>
<div class="h-48 bg-gray-200">
<img src="{{ apartment.image }}" alt="{{ apartment.title }}" class="w-full h-full object-cover">
</div>
<div class="p-6">
<div class="flex justify-between items-start mb-3">
<div>
<h4 class="font-bold">{{ apartment.title }}</h4>
<p class="text-sm text-gray-500">{{ apartment.complex_name }}</p>
</div>
<div class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-sm font-medium">
{{ apartment.rooms }} комн
</div>
</div>
<div class="grid grid-cols-2 gap-4 mb-4">
<div>
<p class="text-gray-500 text-xs">Площадь</p>
<p class="font-medium">{{ apartment.area }} м²</p>
</div>
<div>
<p class="text-gray-500 text-xs">Стоимость</p>
<p class="font-medium">{{ "{:,.0f}".format(apartment.price) }} ₽</p>
</div>
<div>
<p class="text-gray-500 text-xs">Цена за м²</p>
<p class="font-medium">{{ "{:,.0f}".format(apartment.price_per_sqm) }} ₽</p>
</div>
<div>
<p class="text-gray-500 text-xs">Кешбек</p>
<p class="font-medium text-green-600">{{ "{:,.0f}".format(apartment.cashback_amount) }} ₽</p>
</div>
</div>
<div class="flex justify-between items-center">
<p class="text-blue-600 text-sm font-medium">{{ apartment.cashback_percent }}% кешбек</p>
<a href="/property/{{ apartment.id }}" class="text-blue-600 hover:text-purple-600 font-medium text-sm flex items-center">
Подробнее <i class="fas fa-chevron-right ml-1 text-xs"></i>
</a>
</div>
</div>
</div>
{% endfor %}
</div>

<div class="mt-6 text-center">
<a href="/properties?developer={{ developer.name }}" 
class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-xl inline-flex items-center transition-all">
Показать все {{ apartments|length }} квартир <i class="fas fa-chevron-right ml-2"></i>
</a>
</div>
{% else %}
<div class="text-center py-12">
<i class="fas fa-home text-4xl text-gray-300 mb-4"></i>
<p class="text-gray-500">Нет доступных квартир в продаже</p>
</div>
{% endif %}
</div>

<!-- Special Offers -->
<div class="bg-gradient-to-r from-ton-blue to-blue-700 text-white rounded-xl p-8 mb-8">
<h2 class="text-2xl font-bold mb-4">Специальные условия от {{ developer.name }}</h2>
<div class="grid md:grid-cols-3 gap-6">
<div class="text-center">
<div class="text-3xl font-bold mb-2">До {{ developer.max_cashback_percent or "10" }}%</div>
<div class="text-blue-100">Кэшбек с каждой покупки</div>
</div>
<div class="text-center">
<div class="text-3xl font-bold mb-2">{{ developer.min_mortgage_rate or "0.1" }}%</div>
<div class="text-blue-100">Льготная ипотека</div>
</div>
<div class="text-center">
<div class="text-3xl font-bold mb-2">100%</div>
<div class="text-blue-100">Юридическое сопровождение</div>
</div>
</div>
</div>

<!-- CTA Section -->
<div class="bg-ton-blue text-white rounded-xl p-8 text-center">
<h2 class="text-2xl font-bold mb-4">Заинтересовались проектами {{ developer.name }}?</h2>
<p class="text-lg mb-6 opacity-90">Оставьте заявку, и мы поможем выбрать лучший вариант с максимальным кэшбеком</p>
<div class="flex flex-col sm:flex-row justify-center gap-4">
<button onclick="openApplicationModal()" class="px-8 py-3 bg-white text-ton-blue rounded-lg hover:bg-opacity-90 transition-colors font-medium">
Получить консультацию
</button>
<a href="tel:{{ developer.phone or '88001231212' }}" class="px-8 py-3 border border-white text-white rounded-lg hover:bg-white hover:text-ton-blue transition-colors font-medium">
Позвонить сейчас
</a>
</div>
</div>

</div>
</div>
{% endblock %}

{% block scripts %}
<!-- Leaflet CSS and JS for map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
{% if developer.latitude and developer.longitude %}
// Initialize developer location map
document.addEventListener('DOMContentLoaded', function() {
    try {
        const lat = {{ developer.latitude or 45.0428 }};
        const lng = {{ developer.longitude or 38.9769 }};
        const zoom = {{ developer.zoom_level or 13 }};
        
        // Create map
        const map = L.map('developer-map').setView([lat, lng], zoom);
        
        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);
        
        // Add marker for developer office
        L.marker([lat, lng])
            .addTo(map)
            .bindPopup(`
                <div class="p-2">
                    <strong>{{ developer.name }}</strong><br>
                    <small>{{ developer.address or "г. Краснодар" }}</small>
                </div>
            `)
            .openPopup();
    } catch (error) {
        console.error('Error initializing developer map:', error);
        document.getElementById('developer-map').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500"><i class="fas fa-map-marker-alt text-4xl"></i></div>';
    }
});
{% endif %}
</script>
{% endblock %}