# üìç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Nearby –¥–∞–Ω–Ω—ã—Ö

## –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–ª–∏–∑–ª–µ–∂–∞—â–∏—Ö –æ–±—ä–µ–∫—Ç–∞—Ö (—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –º–∞–≥–∞–∑–∏–Ω—ã, —à–∫–æ–ª—ã –∏ —Ç.–¥.) –¥–ª—è –ñ–ö —á–µ—Ä–µ–∑ **OpenStreetMap API**.

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–∞—Ä—Å–µ—Ä–æ–º

### 1. **–ü–∞—Ä—Å–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –ñ–ö –≤ –ë–î**
```sql
INSERT INTO residential_complexes (name, latitude, longitude, ...) 
VALUES ('–ñ–ö –ù–æ–≤—ã–π', 45.0355, 38.9753, ...);
```

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ nearby**

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤:

#### **–°–ø–æ—Å–æ–± 1: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
# –û–±–Ω–æ–≤–∏—Ç—å 5 –ñ–ö –±–µ–∑ nearby –¥–∞–Ω–Ω—ã—Ö
python3 nearby_auto_updater.py

# –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ñ–ö —Ç—Ä–µ–±—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
python3 nearby_auto_updater.py --all
```

#### **–°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ API endpoint**
```bash
# POST –∑–∞–ø—Ä–æ—Å –æ—Ç –∞–¥–º–∏–Ω–∞
curl -X POST http://localhost:5000/admin/nearby/auto-update \
  -H "Cookie: session=..." \
  -d "batch_size=10"
```

#### **–°–ø–æ—Å–æ–± 3: Cron –∑–∞–¥–∞—á–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)**
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å 5 –ñ–ö
*/30 * * * * cd /path/to/project && python3 nearby_auto_updater.py

# –†–∞–∑ –≤ –¥–µ–Ω—å –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Å–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ
0 3 * * * cd /path/to/project && python3 nearby_auto_updater.py --all
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ–ª—å–∫–æ –ñ–ö —Ç—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
curl http://localhost:5000/admin/nearby/status
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "stats": {
    "total_with_coordinates": 50,
    "with_nearby_data": 35,
    "without_nearby_data": 15,
    "outdated": 5,
    "completion_rate": 70.0
  }
}
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ñ–ö –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –µ—Å–ª–∏:
- ‚úÖ –ï—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (latitude, longitude)
- ‚ùå –ù–µ—Ç nearby –¥–∞–Ω–Ω—ã—Ö (`nearby IS NULL`)
- ‚ùå –ù–µ—Ç –¥–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (`nearby_updated_at IS NULL`)
- ‚ùå –î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 6 –º–µ—Å—è—Ü–µ–≤

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞

- **–†–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞:** 3000–º (3 –∫–º) - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è –≥–æ—Ä–æ–¥—Å–∫–∏—Ö —Ä–∞–π–æ–Ω–æ–≤
- **API —Å–µ—Ä–≤–µ—Ä:** overpass.kumi.systems (–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —á–µ–º overpass-api.de)
- **–ë–∞—Ç—á-–∑–∞–ø—Ä–æ—Å—ã:** –í—Å–µ —Ç–µ–≥–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (–±—ã—Å—Ç—Ä–µ–µ!)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏:** 2-3 —Å–µ–∫—É–Ω–¥—ã (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å API)
- **–†–∞–∑–º–µ—Ä –ø–æ—Ä—Ü–∏–∏:** 5-10 –ñ–ö –∑–∞ —Ä–∞–∑

---

## üéØ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–∏–º–µ—Ä—ã | OSM —Ç–µ–≥–∏ |
|-----------|---------|----------|
| üöå **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç** | –ê–≤—Ç–æ–±—É—Å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, –∂/–¥ —Å—Ç–∞–Ω—Ü–∏–∏, –º–µ—Ç—Ä–æ | `highway=bus_stop`, `railway=station`, `station=subway` |
| üõí **–ú–∞–≥–∞–∑–∏–Ω—ã** | –¢–¶, –ü—è—Ç—ë—Ä–æ—á–∫–∞, –ú–∞–≥–Ω–∏—Ç, —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç—ã | `shop=mall`, `shop=supermarket`, `shop=convenience` |
| üìö **–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** | –®–∫–æ–ª—ã, –¥–µ—Ç—Å–∫–∏–µ —Å–∞–¥—ã, –í–£–ó—ã | `amenity=school`, `amenity=kindergarten`, `amenity=university` |
| ‚öïÔ∏è **–ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** | –ë–æ–ª—å–Ω–∏—Ü—ã, –ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∏, –∞–ø—Ç–µ–∫–∏ | `amenity=hospital`, `amenity=clinic`, `amenity=pharmacy` |
| ‚ö° **–°–ø–æ—Ä—Ç** | –ë–∞—Å—Å–µ–π–Ω—ã, —Å–ø–æ—Ä—Ç–∑–∞–ª—ã, —Ñ–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä—ã | `leisure=swimming_pool`, `leisure=sports_centre`, `leisure=fitness_centre` |
| üé≠ **–î–æ—Å—É–≥** | –ü–∞—Ä–∫–∏, –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ç–µ–∞—Ç—Ä—ã | `leisure=park`, `tourism=attraction`, `amenity=cinema` |

–î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ø-5 –±–ª–∏–∂–∞–π—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤.

---

## üìù –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

```json
{
  "transport": [
    {
      "type": "bus_stop",
      "type_display": "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–±—É—Å–∞",
      "name": "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è",
      "distance": 180,
      "coordinates": [43.627, 39.728]
    }
  ],
  "shopping": [
    {
      "type": "supermarket",
      "type_display": "–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç",
      "name": "–ü—è—Ç—ë—Ä–æ—á–∫–∞",
      "distance": 755,
      "coordinates": [43.6627, 39.6705]
    }
  ],
  "education": [...],
  "healthcare": [...],
  "sport": [...],
  "leisure": [...],
  "updated_at": "2025-10-28T19:05:00"
}
```

---

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞—Ä—Å–µ—Ä–æ–º

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
```python
# –í –∫–æ–Ω—Ü–µ —Ä–∞–±–æ—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞
import subprocess
subprocess.run(['python3', 'nearby_auto_updater.py'])
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
```python
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –ø–∞—Ä—Å–µ—Ä–æ–º
import threading

def update_nearby_background():
    while True:
        subprocess.run(['python3', 'nearby_auto_updater.py'])
        time.sleep(1800)  # –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

thread = threading.Thread(target=update_nearby_background, daemon=True)
thread.start()
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Webhook –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
```python
# –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞
requests.post('http://localhost:5000/admin/nearby/auto-update', 
              data={'batch_size': 10})
```

---

## ‚è±Ô∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –î–µ–π—Å—Ç–≤–∏–µ | –í—Ä–µ–º—è |
|----------|-------|
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1 –ñ–ö | ~15-30 —Å–µ–∫ (6 –±–∞—Ç—á-–∑–∞–ø—Ä–æ—Å–æ–≤) |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 5 –ñ–ö (–ø–æ—Ä—Ü–∏—è) | ~2-3 –º–∏–Ω |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 50 –ñ–ö | ~20-30 –º–∏–Ω |

**–ù–æ–≤–∞—è –±–∞—Ç—á-—Å–∏—Å—Ç–µ–º–∞:**
- –í–º–µ—Å—Ç–æ 17 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–µ–ø–µ—Ä—å 6 –±–∞—Ç—á-–∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ timeout –∏ 429 rate limit
- –ù–∞—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–µ –æ–±—ä–µ–∫—Ç–æ–≤ (–≤ —Å—Ä–µ–¥–Ω–µ–º 20 –≤–º–µ—Å—Ç–æ 10)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –û–±–Ω–æ–≤–ª—è—Ç—å –ø–æ—Ä—Ü–∏—è–º–∏ –ø–æ 5-10 –ñ–ö
- –î–µ–ª–∞—Ç—å –ø–∞—É–∑—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (2-3 —Å–µ–∫)
- –ù–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

## üîß Troubleshooting

### –û—à–∏–±–∫–∞: "Overpass API timeout"
- **–ü—Ä–∏—á–∏–Ω–∞:** API –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
- **–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏, —É–º–µ–Ω—å—à–∏—Ç—å batch_size

### –û—à–∏–±–∫–∞: "No objects found"
- **–ü—Ä–∏—á–∏–Ω–∞:** –í —Ä–∞–¥–∏—É—Å–µ 1.5–∫–º –Ω–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ (—Ä–µ–¥–∫–∏–π —Å–ª—É—á–∞–π)
- **–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ä–∞–π–æ–Ω–æ–≤

### –ñ–ö –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: `SELECT id, name, latitude, longitude FROM residential_complexes WHERE latitude IS NULL`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `python3 nearby_auto_updater.py` –ø–æ–∫–∞–∂–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥

---

## üìå –ò—Ç–æ–≥–æ

**–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä—Å–µ—Ä–æ–º:**

1. ‚úÖ –ü–∞—Ä—Å–µ—Ä –∑–∞–ª–∏–≤–∞–µ—Ç –ñ–ö –≤ –ë–î (—Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏!)
2. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç–µ `python3 nearby_auto_updater.py` –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –ø–æ cron
3. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –ñ–ö –±–µ–∑ nearby
4. ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ OpenStreetMap
5. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
6. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ —Å–∞–π—Ç–µ

**–ì–æ—Ç–æ–≤–æ!** üéâ
